!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@thwack/resolve")):"function"==typeof define&&define.amd?define(["@thwack/resolve"],t):(e=e||self).thwack=t(e.resolve)}(this,function(e){const t={"application/json":"json","multipart/form-data":"formData","*/*":"text","text/event-stream":"stream"},r=([e],[t])=>e<t?-1:e>t?1:0,n=e=>Object.entries(e).sort(r).map(([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`).join("&"),s=t=>{const{url:r,baseURL:s=r,params:o,resolver:a=e.resolve,paramsSerializer:c=n}=t,i=a(r,s),[u,p]=((e,t)=>{const r={...t};return[e.split("/").map(e=>{if(e.startsWith(":")){const t=e.substr(1),n=r[t];return delete r[t],encodeURIComponent(n)}return e}).join("/"),r]})(i,o);return((e,t)=>{const r=e.includes("?")?"&":"?";return`${e}${t?r:""}${t}`})(u,c(p))},o="undefined"!=typeof Blob,a=e=>e>=200&&e<300,c={arraybuffer:"arrayBuffer",document:"formData"};class i{constructor(e,t){const{status:r=200,statusText:n="Status "+r,data:s,headers:o={}}=e;this.status=r,this.statusText=n,this.ok=a(r),this.data=s,this.headers="function"==typeof o.entries?Object.fromEntries(o.entries()):o,this.options=t,this.response=e}}class u{constructor(e,t){this.type=e,this.defaultPrevented=!1,this.propagationStopped=!1,this._payload=t}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class p extends u{constructor(e,t){super(e,t),Object.defineProperty(this,"thwackResponse",{get(){return this._payload}})}}class l extends p{constructor(e){super("data",e)}}class d extends p{constructor(e){super("error",e)}}class h extends Error{constructor(e){super("ThwackResponseError"),this.message="Status "+e.status,this.name="ThwackResponseError",this.thwackResponse=e}}const f=function(e){try{const r=this;if(!(e instanceof i))throw new Error("Thwack: callback must return a ThwackResponse");return Promise.resolve(function(e){try{const{response:n,options:s}=e,{responseType:o,responseParserMap:a}=s,i=e.headers["content-type"],u=(r=o||((e="",r)=>{const[n]=e.split(";"),s=n.trim(),[o]=s.split("/"),a={...t,...r};return a[s]||a[o+"/*"]||a["*/*"]})(i,a),c[r]||r);return Promise.resolve("stream"===u?n.body:n[u]?n[u]():e.data)}catch(e){return Promise.reject(e)}var r}(e)).then(function(t){let n;function s(t){if(n)return t;const s=new d(e);return Promise.resolve(r.dispatchEvent(s)).then(function(e){const{defaultPrevented:t}=s;if(t&&e.ok)return f.call(r,e);if(!(e instanceof i))throw new Error("Thwack: callback must return a ThwackResponse");throw new h(e)})}e.data=t;const{validateStatus:o=a}=e.options,c=function(){if(o(e.status)){const t=new l(e);return Promise.resolve(r.dispatchEvent(t)).then(function(e){const{defaultPrevented:s}=t;return s&&!e.ok?(n=1,f.call(r,e)):(n=1,e)})}}();return c&&c.then?c.then(s):s(c)})}catch(e){return Promise.reject(e)}};class m extends p{constructor(e){super("response",e)}}class v extends u{constructor(e){super("request",e),Object.defineProperty(this,"options",{get(){return this._payload}})}}const w=(e={},t={})=>Object.keys({...e,...t}).reduce((r,n)=>{const s=null!=t[n]?t[n]:e[n];return{...r,[n]:(o=s,"[object Object]"===Object.prototype.toString.call(o)?w(e[n],t[n]):s)};var o},{}),y=(e,t)=>w(e.defaults,t),P=function(e){try{const t=this,{...r}=y(t,e),n=new v(r);return Promise.resolve(t.dispatchEvent(n)).then(function(e){const{defaultPrevented:r}=n;if(r)return f.call(t,e);const a=e;return Promise.resolve(function(e){try{const{url:t,baseURL:r,fetch:n,data:a,headers:c,...i}=e;if(!n)throw new Error("Thwack: Invalid options object during request. Check your event callbacks.");a&&!c["content-type"]&&(c["content-type"]=(e=>o&&e instanceof Blob?e.type:"application/json")(a));const u=a&&"application/json"===c["content-type"]?JSON.stringify(a):a,p=s({...e,url:t,baseURL:r}),l={...0!==Object.keys(c).length&&{headers:c},...!!u&&{body:u,method:"POST"},...i};return Promise.resolve(n(p,l))}catch(e){return Promise.reject(e)}}(a)).then(function(e){const r=new m(new i(e,a));return Promise.resolve(t.dispatchEvent(r)).then(function(e){return f.call(t,e)})})})}catch(e){return Promise.reject(e)}},b=e=>e.length>1?{...e[1],url:e[0]}:e[0],k=function(e,t){const r=function(){return r.request(b([].slice.call(arguments)))};return r.defaults=e,r.request=P.bind(r),["GET","DELETE","HEAD"].forEach(e=>{const t=e.toLowerCase();r[t]=(t,n)=>r.request({...n,method:e,url:t})}),["PUT","POST","PATCH"].forEach(e=>{const t=e.toLowerCase();r[t]=(t,n,s)=>r.request({...s,method:e,url:t,data:n})}),r.getUri=e=>{const t=y(r,e);return s(t)},r.create=e=>{const t=y(r,e);return k(t,r)},((e,t)=>{let r=0;const n={request:[],response:[],data:[],error:[]};e.addEventListener=(e,t)=>{n[e].push(t)},e.removeEventListener=(e,t)=>{n[e]=n[e].filter(e=>e!==t)},e.dispatchEvent=e=>n[e.type].reduce((t,n)=>t.then(()=>{if(r+=1,r>=5)throw new Error("Thwack: maximum request depth reached");return e.propagationStopped?void 0:n(e)}).finally(()=>{r-=1}).then(t=>{void 0!==t&&(e._payload=t)}),t?t.dispatchEvent(e):Promise.resolve()).then(()=>e._payload)})(r,t),r},E=k({maxDepth:5,params:{},headers:{accept:"application/json, text/plain, */*"},buildURL:"complete"});if(E.ThwackResponseError=h,E.ThwackResponse=i,E.all=e=>Promise.all(e),E.spread=e=>t=>e(...t),"undefined"!=typeof window){const{fetch:e,location:t}=window;if(E.defaults.fetch=e,t){const{origin:e,pathname:r}=t;E.defaults.baseURL=`${e}${r}`}}return E});
//# sourceMappingURL=thwack.umd.js.map
