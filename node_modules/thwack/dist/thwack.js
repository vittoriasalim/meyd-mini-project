var e=require("@thwack/resolve");const t={"application/json":"json","multipart/form-data":"formData","*/*":"text","text/event-stream":"stream"},r=([e],[t])=>e<t?-1:e>t?1:0,s=e=>Object.entries(e).sort(r).map(([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`).join("&"),n=t=>{const{url:r,baseURL:n=r,params:o,resolver:a=e.resolve,paramsSerializer:c=s}=t,i=a(r,n),[u,p]=((e,t)=>{const r={...t};return[e.split("/").map(e=>{if(e.startsWith(":")){const t=e.substr(1),s=r[t];return delete r[t],encodeURIComponent(s)}return e}).join("/"),r]})(i,o);return((e,t)=>{const r=e.includes("?")?"&":"?";return`${e}${t?r:""}${t}`})(u,c(p))},o="undefined"!=typeof Blob,a=e=>e>=200&&e<300,c={arraybuffer:"arrayBuffer",document:"formData"};class i{constructor(e,t){const{status:r=200,statusText:s="Status "+r,data:n,headers:o={}}=e;this.status=r,this.statusText=s,this.ok=a(r),this.data=n,this.headers="function"==typeof o.entries?Object.fromEntries(o.entries()):o,this.options=t,this.response=e}}class u{constructor(e,t){this.type=e,this.defaultPrevented=!1,this.propagationStopped=!1,this._payload=t}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class p extends u{constructor(e,t){super(e,t),Object.defineProperty(this,"thwackResponse",{get(){return this._payload}})}}class l extends p{constructor(e){super("data",e)}}class h extends p{constructor(e){super("error",e)}}class d extends Error{constructor(e){super("ThwackResponseError"),this.message="Status "+e.status,this.name="ThwackResponseError",this.thwackResponse=e}}const f=function(e){try{const r=this;if(!(e instanceof i))throw new Error("Thwack: callback must return a ThwackResponse");return Promise.resolve(function(e){try{const{response:s,options:n}=e,{responseType:o,responseParserMap:a}=n,i=e.headers["content-type"],u=(r=o||((e="",r)=>{const[s]=e.split(";"),n=s.trim(),[o]=n.split("/"),a={...t,...r};return a[n]||a[o+"/*"]||a["*/*"]})(i,a),c[r]||r);return Promise.resolve("stream"===u?s.body:s[u]?s[u]():e.data)}catch(e){return Promise.reject(e)}var r}(e)).then(function(t){let s;function n(t){if(s)return t;const n=new h(e);return Promise.resolve(r.dispatchEvent(n)).then(function(e){const{defaultPrevented:t}=n;if(t&&e.ok)return f.call(r,e);if(!(e instanceof i))throw new Error("Thwack: callback must return a ThwackResponse");throw new d(e)})}e.data=t;const{validateStatus:o=a}=e.options,c=function(){if(o(e.status)){const t=new l(e);return Promise.resolve(r.dispatchEvent(t)).then(function(e){const{defaultPrevented:n}=t;return n&&!e.ok?(s=1,f.call(r,e)):(s=1,e)})}}();return c&&c.then?c.then(n):n(c)})}catch(e){return Promise.reject(e)}};class m extends p{constructor(e){super("response",e)}}class v extends u{constructor(e){super("request",e),Object.defineProperty(this,"options",{get(){return this._payload}})}}const w=(e={},t={})=>Object.keys({...e,...t}).reduce((r,s)=>{const n=null!=t[s]?t[s]:e[s];return{...r,[s]:(o=n,"[object Object]"===Object.prototype.toString.call(o)?w(e[s],t[s]):n)};var o},{}),y=(e,t)=>w(e.defaults,t),P=function(e){try{const t=this,{...r}=y(t,e),s=new v(r);return Promise.resolve(t.dispatchEvent(s)).then(function(e){const{defaultPrevented:r}=s;if(r)return f.call(t,e);const a=e;return Promise.resolve(function(e){try{const{url:t,baseURL:r,fetch:s,data:a,headers:c,...i}=e;if(!s)throw new Error("Thwack: Invalid options object during request. Check your event callbacks.");a&&!c["content-type"]&&(c["content-type"]=(e=>o&&e instanceof Blob?e.type:"application/json")(a));const u=a&&"application/json"===c["content-type"]?JSON.stringify(a):a,p=n({...e,url:t,baseURL:r}),l={...0!==Object.keys(c).length&&{headers:c},...!!u&&{body:u,method:"POST"},...i};return Promise.resolve(s(p,l))}catch(e){return Promise.reject(e)}}(a)).then(function(e){const r=new m(new i(e,a));return Promise.resolve(t.dispatchEvent(r)).then(function(e){return f.call(t,e)})})})}catch(e){return Promise.reject(e)}},b=e=>e.length>1?{...e[1],url:e[0]}:e[0],E=function(e,t){const r=function(){return r.request(b([].slice.call(arguments)))};return r.defaults=e,r.request=P.bind(r),["GET","DELETE","HEAD"].forEach(e=>{const t=e.toLowerCase();r[t]=(t,s)=>r.request({...s,method:e,url:t})}),["PUT","POST","PATCH"].forEach(e=>{const t=e.toLowerCase();r[t]=(t,s,n)=>r.request({...n,method:e,url:t,data:s})}),r.getUri=e=>{const t=y(r,e);return n(t)},r.create=e=>{const t=y(r,e);return E(t,r)},((e,t)=>{let r=0;const s={request:[],response:[],data:[],error:[]};e.addEventListener=(e,t)=>{s[e].push(t)},e.removeEventListener=(e,t)=>{s[e]=s[e].filter(e=>e!==t)},e.dispatchEvent=e=>s[e.type].reduce((t,s)=>t.then(()=>{if(r+=1,r>=5)throw new Error("Thwack: maximum request depth reached");return e.propagationStopped?void 0:s(e)}).finally(()=>{r-=1}).then(t=>{void 0!==t&&(e._payload=t)}),t?t.dispatchEvent(e):Promise.resolve()).then(()=>e._payload)})(r,t),r},k=E({maxDepth:5,params:{},headers:{accept:"application/json, text/plain, */*"},buildURL:"complete"});if(k.ThwackResponseError=d,k.ThwackResponse=i,k.all=e=>Promise.all(e),k.spread=e=>t=>e(...t),"undefined"!=typeof window){const{fetch:e,location:t}=window;if(k.defaults.fetch=e,t){const{origin:e,pathname:r}=t;k.defaults.baseURL=`${e}${r}`}}module.exports=k;
//# sourceMappingURL=thwack.js.map
